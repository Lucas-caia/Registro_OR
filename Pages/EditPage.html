<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Editar Registro</title>
  <link rel="stylesheet" href="/css/edit.css">
</head>
<body>
<h2>Editar Registro</h2>
<div class="container">
  <div class="form-field">
    <label for="nome">Nome:</label>
    <input type="text" id="nome" required>
  </div>
  <div class="form-field">
    <label for="vidaAtual">Vida Atual:</label>
    <input type="number" id="vidaAtual" min="0" required>
  </div>
  <div class="form-field">
    <label for="vidaMax">Vida Máxima:</label>
    <input type="number" id="vidaMax" min="1" required>
  </div>
  <div class="form-field">
    <label for="sanidadeAtual">Sanidade Atual:</label>
    <input type="number" id="sanidadeAtual" min="0" required>
  </div>
  <div class="form-field">
    <label for="sanidadeMax">Sanidade Máxima:</label>
    <input type="number" id="sanidadeMax" min="1" required>
  </div>
  <div class="form-field">
    <label for="esforcoAtual">Esforço Atual:</label>
    <input type="number" id="esforcoAtual" min="0" required>
  </div>
  <div class="form-field">
    <label for="esforcoMax">Esforço Máximo:</label>
    <input type="number" id="esforcoMax" min="1" required>
  </div>
  <div class="form-field">
    <label for="pm">Pontos de Missão (PM):</label>
    <input type="number" id="pm" min="0" required>
  </div>
  <div class="form-field">
    <label for="data">Data:</label>
    <input type="date" id="data" required>
  </div>

  <!-- Container para os botões, que serão exibidos um à esquerda e outro à direita -->
  <div class="button-container">
    <button id="save-button">Salvar</button>
    <button id="delete-button">Excluir</button>
  </div>
</div>

<script>
  function getIdFromUrl() {
    const params = new URLSearchParams(window.location.search);
    return params.get("id");
  }

  document.addEventListener("DOMContentLoaded", () => {
    const id = getIdFromUrl();
    let registros = JSON.parse(localStorage.getItem("registros")) || [];

    if (id === null || !registros[id]) {
      alert("Registro não encontrado!");
      window.close();
      return;
    }

    const registro = registros[id];
    document.getElementById("nome").value = registro.nome;
    document.getElementById("vidaAtual").value = registro.vidaAtual;
    document.getElementById("vidaMax").value = registro.vidaMax;
    document.getElementById("sanidadeAtual").value = registro.sanidadeAtual;
    document.getElementById("sanidadeMax").value = registro.sanidadeMax;
    document.getElementById("esforcoAtual").value = registro.esforcoAtual;
    document.getElementById("esforcoMax").value = registro.esforcoMax;
    document.getElementById("pm").value = registro.pm;
    document.getElementById("data").value = registro.data;
  });

  document.getElementById("save-button").addEventListener("click", () => {
    const id = getIdFromUrl();
    let registros = JSON.parse(localStorage.getItem("registros")) || [];

    if (id === null || !registros[id]) {
      alert("Registro não encontrado!");
      return;
    }

    const nome = document.getElementById("nome").value.trim();
    const vidaAtual = parseInt(document.getElementById("vidaAtual").value) || 0;
    const vidaMax = parseInt(document.getElementById("vidaMax").value) || 1;
    const sanidadeAtual = parseInt(document.getElementById("sanidadeAtual").value) || 0;
    const sanidadeMax = parseInt(document.getElementById("sanidadeMax").value) || 1;
    const esforcoAtual = parseInt(document.getElementById("esforcoAtual").value) || 0;
    const esforcoMax = parseInt(document.getElementById("esforcoMax").value) || 1;
    const pm = parseInt(document.getElementById("pm").value) || 0;
    const data = document.getElementById("data").value;

    if (!nome || !data) {
      alert("Por favor, preencha todos os campos!");
      return;
    }

    registros[id] = {
      nome,
      vidaAtual,
      vidaMax,
      sanidadeAtual,
      sanidadeMax,
      esforcoAtual,
      esforcoMax,
      pm,
      data
    };

    localStorage.setItem("registros", JSON.stringify(registros));

    if (window.opener && !window.opener.closed) {
      window.opener.location.reload();
    }

    window.close();
  });

  document.getElementById("delete-button").addEventListener("click", () => {
    if (!confirm("Tem certeza que deseja excluir este registro?")) {
      return;
    }
    const id = getIdFromUrl();
    let registros = JSON.parse(localStorage.getItem("registros")) || [];

    if (id === null || !registros[id]) {
      alert("Registro não encontrado!");
      return;
    }

    registros.splice(id, 1);
    localStorage.setItem("registros", JSON.stringify(registros));

    if (window.opener && !window.opener.closed) {
      window.opener.location.reload();
    }

    alert("Registro excluído com sucesso!");
    window.close();
  });
</script>
</body>
</html>
