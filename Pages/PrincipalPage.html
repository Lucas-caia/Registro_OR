<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Página Principal</title>
  <link rel="stylesheet" href="/css/style.css">
  <style>
    /* Botões de exportação e importação no canto superior direito */
    #action-container {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1000;
    }
    #export-button, #import-button {
      padding: 8px 12px;
      font-size: 14px;
      cursor: pointer;
      margin-left: 5px;
    }
    /* Container para exibir o JSON exportado */
    #export-display {
      margin: 20px auto;
      max-width: 800px;
      white-space: pre-wrap;
      background: #f4f4f4;
      padding: 10px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
<header>
  <h1>Registros</h1>
</header>
<!-- Container para botões de ações -->
<div id="action-container">
  <button id="export-button">Exportar Dados</button>
  <button id="import-button">Importar Dados</button>
  <!-- Input oculto para importar o arquivo -->
  <input type="file" id="import-file" accept=".json" style="display:none;">
</div>
<div id="search-container">
  <input type="text" id="search-input" placeholder="Pesquisar por nome...">
</div>
<main id="registros-container"></main>
<button id="add-button">+</button>
<script>
  const saveButton = document.getElementById("save-button");

  saveButton.addEventListener("click", () => {
    // Desabilita o botão para evitar cliques múltiplos enquanto a requisição está sendo processada.
    saveButton.disabled = true;

    // Coleta os valores dos campos e define valores padrão quando necessário
    const nome = document.getElementById("nome").value.trim();
    const vidaMax = parseInt(document.getElementById("vidaMax").value) || 1;
    const sanidadeMax = parseInt(document.getElementById("sanidadeMax").value) || 1;
    const esforcoMax = parseInt(document.getElementById("esforcoMax").value) || 1;
    const pm = parseInt(document.getElementById("pm").value) || 0;
    const dinheiro = parseInt(document.getElementById("dinheiro").value) || 0;
    const classe = document.getElementById("classe").value;
    const trilha = document.getElementById("trilha").value.trim();
    const origem = document.getElementById("origem").value;
    const idade = parseInt(document.getElementById("idade").value) || 0;
    const missoes = document.getElementById("missoes").value.split(",").map(item => item.trim()).filter(item => item);
    const habilidades = document.getElementById("habilidades").value.split(",").map(item => item.trim()).filter(item => item);
    const rituais = document.getElementById("rituais").value.split(",").map(item => item.trim()).filter(item => item);

    // Verifica se os campos obrigatórios foram preenchidos
    if (!nome || !classe || !trilha || !origem) {
      alert("Por favor, preencha todos os campos obrigatórios!");
      saveButton.disabled = false;
      return;
    }

    // Monta o objeto do novo registro
    const novoRegistro = {
      nome,
      vidaMax,
      sanidadeMax,
      esforcoMax,
      pm,
      dinheiro,
      classe,
      trilha,
      origem,
      idade,
      missoes,
      habilidades,
      rituais,
      data: new Date().toISOString()  // Armazena a data/hora da criação
    };

    // Envia a requisição POST para criar o registro
    fetch('http://localhost:3000/api/registros', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(novoRegistro)
    })
      .then(response => {
        if (!response.ok) {
          throw new Error("Erro ao salvar registro.");
        }
        return response.json();
      })
      .then(data => {
        alert("Registro salvo com sucesso!");
        // Atualiza a página Principal, se ela estiver aberta, e fecha a janela atual
        if (window.opener) {
          window.opener.location.reload();
        }
        window.close();
      })
      .catch(error => {
        console.error("Erro:", error);
        alert("Falha ao salvar registro.");
        // Reabilita o botão caso ocorra erro
        saveButton.disabled = false;
      });
  });
</script>
</body>
</html>
